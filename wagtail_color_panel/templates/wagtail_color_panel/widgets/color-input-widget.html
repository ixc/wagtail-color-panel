<div class="color-input-widget">
    {% include "django/forms/widgets/text.html" %}

    {% with widget.attrs.id as widget_id %}
    <input class="color-input-widget__color-input" type="color" name="{{ widget_id }}-color" value="{{ widget.value }}" maxlength="7" id="{{ widget_id }}-color">

    <script>
        document.getElementById("{{ widget_id }}-color").addEventListener("input", function(evt) {
            document.getElementById("{{ widget_id }}").value = evt.target.value;
        }, false);

        document.getElementById("{{ widget_id }}").addEventListener("input", function(evt) {
            document.getElementById("{{ widget_id }}-color").value = evt.target.value;
        }, false);

        // Hacky fix for bug with Wagtail 2.13+ where color input doesn't get updated
        // on initial render but text input does (still a half a second delay)
        window.addEventListener("DOMContentLoaded", () => {
            document.getElementById("{{ widget_id }}-color").value =
            document.getElementById("{{ widget_id }}").value
        }, false);
    </script>
    {% endwith %}
</div>
